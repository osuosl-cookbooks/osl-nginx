server {
  listen  80;
  server_name  etherpad-lite.osuosl.org www.etherpad-lite.osuosl.org;

  location / {

    rewrite ^/$ / break;
    rewrite ^/locales/(.*) /locales/$1 break;
    rewrite ^/locales.json /locales.json break;
    rewrite ^/admin(.*) /admin/$1 break;
    rewrite ^/p/(.*) /p/$1 break;
    rewrite ^/static/(.*) /static/$1 break;
    rewrite ^/pluginfw/(.*) /pluginfw/$1 break;
    rewrite ^/javascripts/(.*) /javascripts/$1 break;
    rewrite ^/socket.io/(.*) /socket.io/$1 break;
    rewrite ^/ep/(.*) /ep/$1 break;
    rewrite ^/minified/(.*) /minified/$1 break;
    rewrite ^/api/(.*) /api/$1 break;
    rewrite ^/ro/(.*) /ro/$1 break;
    rewrite ^/error/(.*) /error/$1 break;
    rewrite ^/jserror(.*) /jserror$1 break;
    rewrite /favicon.ico /favicon.ico break;
    rewrite /robots.txt /robots.txt break;
    rewrite /(.*) /p/$1;

    proxy_buffering off;
    proxy_set_header Host $host;
    proxy_pass http://127.0.0.1:9001/;
  }
}
server {
  listen  443;
  server_name  localhost notes.openmrs.org;

  ssl on;
  ssl_certificate  /etc/nginx/ssl/chain.openmrs.org.crt;
  ssl_certificate_key  /etc/nginx/ssl/star.dev.openmrs.org.pem;

  ssl_session_timeout  5m;

  ssl_protocols  SSLv2 SSLv3 TLSv1;
  ssl_ciphers  ALL:!ADH:!EXPORT56:RC4+RSA:+HIGH:+MEDIUM:+LOW:+SSLv2:+EXP;
  ssl_prefer_server_ciphers   on;

  access_log  /var/log/nginx/localhost.access.log;

  location / {

    rewrite ^/$ / break;
    rewrite ^/locales/(.*) /locales/$1 break;
    rewrite ^/locales.json /locales.json break;
    rewrite ^/admin(.*) /admin/$1 break;
    rewrite ^/p/(.*) /p/$1 break;
    rewrite ^/static/(.*) /static/$1 break;
    rewrite ^/pluginfw/(.*) /pluginfw/$1 break;
    rewrite ^/javascripts/(.*) /javascripts/$1 break;
    rewrite ^/socket.io/(.*) /socket.io/$1 break;
    rewrite ^/ep/(.*) /ep/$1 break;
    rewrite ^/minified/(.*) /minified/$1 break;
    rewrite ^/api/(.*) /api/$1 break;
    rewrite ^/ro/(.*) /ro/$1 break;
    rewrite ^/error/(.*) /error/$1 break;
    rewrite ^/jserror(.*) /jserror$1 break;
    rewrite /favicon.ico /favicon.ico break;
    rewrite /robots.txt /robots.txt break;
    rewrite /(.*) /p/$1;

    proxy_buffering off;
    proxy_set_header Host $host;
    proxy_pass http://127.0.0.1:9001/;
  }
}