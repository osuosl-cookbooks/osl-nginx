#
# Generated by chef for <%= node['fqdn'] %>. Do not modify by hand
#
server {
  listen <%= @params[:server_port] || node['osl-nginx']['server_port'] %>;
  server_name <%= @params[:name] %><% @server_aliases.each do |a| %> <%=a%><% end %>;
  root <%= @params[:directory] || "/var/www/#{@params[:name]}" %>;
  <% if @params[:directory_index] %>
  index <% @params[:directory_index].each do |i| %> <%= i %><% end %>;
  <% else %>
  index <% node['osl-nginx']['directory_index'].each do |i| %> <%= i %><% end %>;
  <% end %>
  <% if @params[:include_config] then  %>

  include <%= "#{@nginx_dir}/sites-available/#{@params[:include_name] || @params[:name]}_include.conf" %>;
  <% end %>
  <% if @params[:directive_http] %>

  <% @params[:directive_http].each do |d| %>
  <%= d %>
  <% end %>
  <% end %>
  <% if !@params[:custom_logs] then %>

  access_log <%= "#{@nginx_log_dir}/#{@params[:name]}/access/access.log" %>;
  error_log <%= "#{@nginx_log_dir}/#{@params[:name]}/error/error.log" %>;
  <% end %>
}

<% if @params[:ssl_enable] and @params[:cert_file] and @params[:cert_key] %>
server {
  listen 443 ssl;
  server_name <%= @params[:name] %><% @server_aliases.each do |a| %> <%=a%><% end %>;
  root <%= @params[:directory] || "/var/www/#{@params[:name]}" %>;
  <% if @params[:directory_index] %>
  index <% @params[:directory_index].each do |i| %> <%= i %><% end %>;
  <% else %>
  index <% node['osl-nginx']['directory_index'].each do |i| %> <%= i %><% end %>;
  <% end %>

  ssl_certificate <%= @params[:cert_file] %>;
  ssl_certificate_key <%= @params[:cert_key] %>;
  <% if @params[:include_config] then  %>

  include <%= "#{@nginx_dir}/sites-available/#{@params[:include_name] || @params[:name]}_include.conf" %>;
  <% end %>
  <% if @params[:directive_https] %>

  <% @params[:directive_https].each do |d| %>
  <%= d %>
  <% end %>
  <% end %>
  <% if !@params[:custom_logs] then %>

  access_log <%= "#{@nginx_log_dir}/#{@params[:name]}/access/access.log" %>;
  error_log <%= "#{@nginx_log_dir}/#{@params[:name]}/error/error.log" %>;
  <% end %>
}
<% end %>
